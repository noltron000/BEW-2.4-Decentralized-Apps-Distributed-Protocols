
# How to Host a Site on the Dark Web

| Author                       | Published   | Accessed   | Modifications                        |
| ---------------------------- | ----------  | ---------- | ------------------------------------ |
| **[Jason Rigden]** [üîó]      | 02/12/2018  | 06/10/2019 | *Edited/formatted for classroom use* |

In this tutorial we will be setting up a server that will host a static site on the [Dark Web](https://en.wikipedia.org/wiki/Dark_web). We will be using Tor Hidden services for this. We will be using static files for simplicity and security.

This tutorial is intended for and tested on a **remote** server running Ubuntu 16.04. This server should be **properly secured** for production use. If you need assistance setting up a server, please read my tutorial [Setting Up a Basic Server with Ubuntu 16.04](https://medium.com/@mr_rigden/setting-up-a-basic-server-with-ubuntu-16-04-ea4969db1e6c)This tutorial also will assume that you have a basic familiarity with the Dark Web and you already have the Tor Browser.

### Table of Contents
1. [Tor](#tor)
2. [The Hidden Service](#the-hidden-service)
3. [Install a Web Server](#install-a-web-server)
4. [Configure a Firewall](#configure-a-firewall)
5. [Configure Nginx](#configure-nginx)
6. [Web Server Root Directory](#web-server-root-directory)
7. [Remove Nginx Default](#remove-nginx-default)
8. [Add Available Site](#add-available-site)
9. [Launch the Tor Browser](#launch-the-tor-browser)
10. [Wrapping Up](#wrapping-up)
11. [Challenges](#challenges)

## Tor

The Tor packages found in the default repositories for Ubuntu are not reliably updated. The Tor project maintains their own repository. We must add that repository.

Open up the `/etc/apt/sources.list` file in the `nano` editor:

```bash
sudo nano /etc/apt/sources.list
```

Add the following to the end of the file:

```bash
deb http://deb.torproject.org/torproject.org xenial main
deb-src http://deb.torproject.org/torproject.org xenial main
```

Now add the GPG key.

```bash
gpg --keyserver keys.gnupg.net --recv A3C4F0F979CAA22CDBA8F512EE8CBC9E886DDD89
gpg --export A3C4F0F979CAA22CDBA8F512EE8CBC9E886DDD89 | sudo apt-key add -
```

Run the update.

```bash
sudo apt-get update
```

Then install Tor

```bash
sudo apt-get install tor deb.torproject.org-keyring
```

## The Hidden Service

We need to edit the Tor configuration file to enable our hidden service. First we will make a backup of this configuration file.

```bash
sudo cp /etc/tor/torrc /etc/tor/OLD.torrc
```

Then edit the configuration file.

```bash
sudo nano /etc/tor/torrc
```

By default, all client services, relays, and hidden services are commented out and disabled.

We'll need to activate them ourselves. Locate the section for hidden services.

It will look something like this:

```bash
############### This section is just for location-hidden services ###

## Once you have configured a hidden service, you can look at the
## contents of the file ".../hidden_service/hostname" for the address
## to tell people.
##
## HiddenServicePort x y:z says to redirect requests on port x to the
## address y:z.

#HiddenServiceDir /var/lib/tor/hidden_service/
#HiddenServicePort 80 127.0.0.1:80

#HiddenServiceDir /var/lib/tor/other_hidden_service/
#HiddenServicePort 80 127.0.0.1:80
#HiddenServicePort 22 127.0.0.1:22
```

Locate and uncomment the following lines:

```bash
#HiddenServiceDir /var/lib/tor/hidden_service/
#HiddenServicePort 80 127.0.0.1:80
```

The resulting configuration should look like this:

```bash
############### This section is just for location-hidden services ###

## Once you have configured a hidden service, you can look at the
## contents of the file ".../hidden_service/hostname" for the address
## to tell people.
##
## HiddenServicePort x y:z says to redirect requests on port x to the
## address y:z.

HiddenServiceDir /var/lib/tor/hidden_service/
HiddenServicePort 80 127.0.0.1:80

#HiddenServiceDir /var/lib/tor/other_hidden_service/
#HiddenServicePort 80 127.0.0.1:80
#HiddenServicePort 22 127.0.0.1:2
```

We'll need to restart Tor in order for the new configuration to take effect:

```bash
sudo service tor restart
```

Upon restart, a few files are generated by Tor --- including a hostname file. Peek inside to discover your brand new `.onion` address! After running the below command, you should see an address similar to mine (`fillinlater.onion`): a bunch of random characters concluding in `.onion`.

```bash
$ sudo cat /var/lib/tor/hidden_service/hostname

TODO fillinlater.onion
```

The other file is a private key. Let's open it up and take a look:

```bash
$ sudo cat /var/lib/tor/hidden_service/private_key

-----BEGIN RSA PRIVATE KEY-----
MIICXgIBAAKBgQCnNsOc9iODyPGeLFvkTcgENzZ/c1aKAwslQ/WwLjd9rRh4rfK7
4887uS+Thb3ggnVDc+GKHwkBlJY5Zvo95atYIHigGHR1QCbZ1GCBt4YebLcCBrNG
1zsDoDEbxu4MqVB+0dntEJ2CDciHz6lnSvz9VJoWA8m5PNlC4ITZ+v1prQIDAQAB
AoGBAKCCPCFmUE8HS492qzqqwy3wxfpvf4l5RHCgHK3in1efGZd1+kQLeHiu2ZF1
Vv+0mtWF3eDUy7g0oDluck1337Haxor1FcoKGEgpCXtVnOuEnEJEn/K+dFsxFYBd
AUuZ61yOC7cWySAJA1pi5CtJQm1aH10IxyNYg9kjOPbEiIjBAkEA3UtXwwTxHWLZ
hvcBLzM3uQ31CK93HKar40DyYmlOHZfHPhzgwjr3gwbAjqKnx0AXcnBuhy1gwwW8
U4V6yDSNyrqfiYcMPCYVEKZV/ebmBLW0BWOw+kimukGhGQ==
-----END RSA PRIVATE KEY-----
```

**PROTIP**: Save the contents of  `/var/lib/tor/hidden_service/hostname` and `/var/lib/tor/hidden_service/private_key` somewhere secure, for example,  a password vault. You will need these two files if you want to host your website on another server in the future.

## Install a Web Server

Begin by installing [Nginx](https://www.nginx.com/), an open source web server that powers over 400 million websites:

```bash
sudo apt-get install nginx
```
## Configure a Firewall

Your server should be running a firewall. I recommend the Uncomplicated Firewall (UFW). Check out this [Guide to the Uncomplicated Firewall (UFW) for Linux](https://medium.com/@mr_rigden/a-guide-to-the-uncomplicated-firewall-ufw-for-linux-570c3774d7f4).

Run the following command to allow HTTP traffic.

```bash
sudo ufw allow 'Nginx HTTP'
```

In your browser, visit your server‚Äôs IP address to verify that the web server is operational.

If things are working correctly, remove this rule. Then reload the firewall.

```bash
sudo ufw deny 'Nginx HTTP'
sudo ufw reload
```

## Configure Nginx

Edit the main Nginx application configuration file to disable undesirable information sharing:

```bash
sudo nano /etc/nginx/nginx.conf
```

Inside the `http` block, add the following three lines:

```nginx
server_name_in_redirect off;
server_tokens off;
port_in_redirect off;
```

Save the file, exit `nano`, then restart the Nginx server:

```bash
sudo systemctl restart nginx
```

## Web Server Root Directory

Create a directory to hold the code for our website:

```bash
sudo mkdir /var/www/darkweb
```

Make and edit an `index.html` file for your site.

```bash
sudo nano /var/www/darkweb/index.html
```

Here's a quick HTML page you can test:

```html
<!DOCTYPE html>
<html>
  <head>
    <title>‚ò†Ô∏è‚ò†Ô∏è‚ò†Ô∏è</title>
  </head>
  <body>
    <h1>Ô∏èüíÄWelcome to the Dark Web üíÄ</h1>
  </body>
</html>
```

Nginx needs to access the website's files in order to serve them. Running the next command (`chmod 755 /var/www/darkweb`) allows all users to read and execute the directory; the file owner may write to the directory as well.

```bash
sudo chmod 755 /var/www/darkweb
```

## Remove Nginx Default

Nginx ships with a default site. We don't need it, since we made our own! Delete them now:

```bash
sudo rm /etc/nginx/sites-enabled/default && sudo rm /etc/nginx/sites-available/default
```

## Add Available Site

Make a new site in the `sites-available` directory.

```bash
sudo nano /etc/nginx/sites-available/darkweb
```

Paste the following configuration block. Replace the `server_name` value with the `.onion` address you discovered earlier.

```nginx
server {
  listen 127.0.0.1:80;
  root /var/www/darkweb/;
  index index.html;
  server_name REPLACE_ME.onion;
}
```

Enabling the `darkweb` site to serve your `.onion`:

```bash
sudo ln -s /etc/nginx/sites-available/darkweb /etc/nginx/sites-enabled/
```

Whew! Wrap up by restarting the Nginx server:

```bash
sudo systemctl restart nginx
```

## Launch the Tor Browser

Open up your Tor Browser, and paste the  `.onion` address you generated earlier.

If the system works, then you'll see the test page we created earlier, with the text, .

## Wrapping Up

You've deployed your first decentralized website! n fact, any file in the `/var/www/darkweb` directory will be available on the Tor network.

**PROTIP**: Use a static site generator? Place the output of your build in the `/var/www/darkweb` directory. It will be instantly accessible online!

[Jason Rigden]: https://medium.com/@jasonrigden
[üîó]: https://medium.com/@jasonrigden/how-to-host-a-site-on-the-dark-web-38edf00996bf

## Challenges

1. Can you deploy a more sophisticated website on your `.onion` address?
1. Explore and participate in other decentralized networks like FreeNode.
